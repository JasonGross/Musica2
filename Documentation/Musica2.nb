(************** Content-type: application/mathematica **************
                     CreatedBy='Mathematica 5.0'

                    Mathematica-Compatible Notebook

This notebook can be used with any Mathematica-compatible
application, such as Mathematica, MathReader or Publicon. The data
for the notebook starts with the line containing stars above.

To get the notebook into a Mathematica-compatible application, do
one of the following:

* Save the data starting with the line of stars above into a file
  with a name ending in .nb, then open the file inside the
  application;

* Copy the data starting with the line of stars above to the
  clipboard, then use the Paste menu command inside the application.

Data for notebooks contains only printable 7-bit ASCII and can be
sent directly in email or through ftp in text mode.  Newlines can be
CR, LF or CRLF (Unix, Macintosh or MS-DOS style).

NOTE: If you modify the data for this notebook not in a Mathematica-
compatible application, you must delete the line below containing
the word CacheID, otherwise Mathematica-compatible applications may
try to use invalid cache data.

For more information on notebooks and Mathematica-compatible 
applications, contact Wolfram Research:
  web: http://www.wolfram.com
  email: info@wolfram.com
  phone: +1-217-398-0700 (U.S.)

Notebook reader applications are available free of charge from 
Wolfram Research.
*******************************************************************)

(*CacheID: 232*)


(*NotebookFileLineBreakTest
NotebookFileLineBreakTest*)
(*NotebookOptionsPosition[     24431,        819]*)
(*NotebookOutlinePosition[     25127,        843]*)
(*  CellTagsIndexPosition[     25083,        839]*)
(*WindowFrame->Normal*)



Notebook[{

Cell[CellGroupData[{
Cell["Musica2", "Title"],

Cell["Documentation on the Musica2 package.", "Text"],

Cell[CellGroupData[{

Cell["Licence", "Subtitle"],

Cell["\<\
Copyright (C) 2004 Bo C. Herlin

This program is free software;you can redistribute it and/or
modify it under the terms of the GNU General Public License
as published by the Free Software Foundation;either version 2
of the License,or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY;without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
See the GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program;if not,write to the Free Software Foundation,
Inc.,59 Temple Place-Suite 330,Boston,MA 02111-1307,USA.\
\>", "Text"]
}, Open  ]],

Cell[CellGroupData[{

Cell["History", "Subtitle"],

Cell["\<\
2004-08-13 Bo C. Herlin : added Midi(Add|Get|Rem|Set)(Notes|QPM), \
enamed MidiEqualizeEOT to MidiAddEOT
2004-08-11 Bo C. Herlin : added SoundSetDuration to be used in MidiToSound
2004-08-10 Bo C. Herlin : removed call to MidiAddEOT, added SoundPitchShift
2004-08-09 Bo C. Herlin : minor changes to reflect the code. 
2004-08-08 Bo C. Herlin : added this new state-thing 
2004-08-04 Bo C. Herlin : first release
2004-07-28 Bo C. Herlin : created\
\>", "Text"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Init", "Subtitle"],

Cell["\<\
Load Musica2 which in turn will load each package when \
needed.\
\>", "Text"],

Cell[BoxData[
    \(<< Musica2`\)], "Input",
  InitializationCell->True],

Cell["\<\
A small example below uses a tiny part of the Audio package when \
creating a triangle sound.\
\>", "Text"],

Cell[BoxData[
    \(<< Miscellaneous`Audio`\)], "Input",
  InitializationCell->True],

Cell["Set DataFolder to the folder containing the testfiles.", "Text"],

Cell[BoxData[
    \(\(DataFolder = "\<Musica2/Documentation/Data/\>";\)\)], "Input",
  InitializationCell->True],

Cell[BoxData[
    \(\(\(\(cor := DataFolder <> "\<cor.mid\>"\) \)\(;\)\( (*\ 2.9  kb, \ 
      J . S . Bach, \ bwv\ 323, \ choral, \ Holy, \ 
      holy, \ \(\(holy\)\(.\)\)\ *) \)\(\[IndentingNewLine]\)\(\(fug := 
        DataFolder <> "\<fug.mid\>"\) \)\(;\)\( (*\ 6.1  kb, \ 
      J . S . Bach, \ bwv\ 846  b, \ fugue\ 1\ in\ C\ major, \ 
      wtc1\ *) \)\(\[IndentingNewLine]\)\(\(cun := 
        DataFolder <> "\<cun.mid\>"\) \)\(;\)\( (*\ 6.4  kb, \ 
      J . S . Bach, \ bwv\ 1080  a, \ contrapunctus\ 1, \ 
      cunst\ die\ fugue\ *) \)\(\[IndentingNewLine]\)\(\(pre := 
        DataFolder <> "\<pre.mid\>"\) \)\(;\)\( (*\ 8.9  kb, \ 
      J . S . Bach, \ bwv\ 847  a, \ preludium\ 2\ in\ C\ minor, \ 
      wtc1\ *) \)\)\)], "Input",
  InitializationCell->True],

Cell["Set MidiTestFile to the file to apply the tests to.", "Text"],

Cell[BoxData[{
    \(\(MidiTestFile := cor;\)\), "\[IndentingNewLine]", 
    \(\(MidiTestFileList := {cor, fug, cun, pre};\)\)}], "Input",
  InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["Tour of Musica2", "Subtitle"],

Cell["\<\
Eventually there will be functions for manipulating Midi-objects, \
like getting, adding and removing things like notes and stuff.\
\>", "Text"],

Cell[CellGroupData[{

Cell["Midi", "Subsubtitle"],

Cell["Read from a SMF (StandardMidiFile).", "Text"],

Cell[BoxData[
    \(m = MidiImportSMF[MidiTestFile]\)], "Input"],

Cell["\<\
Midi contain two parts: info and music. Info is a list of rules \
with values for different attributes and music is the midi-data whos \
structure depends on info.\
\>", "Text"],

Cell["\<\
Info contain rules for each attribute:
\tMidiFileFormat (0 or 1),if omitted defaults to Options[Midi]
\tMidiShape (MidiFile,MidiVoice or MidiChord)
\tMidiTimeUnit (MidiTick or MidiSec)
\tMidiTiming (MidiDelta or MidiAbsolute)
\tMidiTPQ (TickPerQuarter),if omitted defaults to Options[Midi]
\tMidiQPM (QuarterPerMinute),if omitted defaults to Options[Midi], used as \
default tempo\
\>", "Text"],

Cell[BoxData[
    \(MidiGetInfo[m]\)], "Input"],

Cell[BoxData[
    \(Options[Midi]\)], "Input"],

Cell["\<\
The info-parts MidiShape, MidiTimeUnit and MidiTiming are called \
the State.\
\>", "Text"],

Cell[BoxData[
    \(MidiGetState[m]\)], "Input"],

Cell["Write to a SMF.", "Text"],

Cell[BoxData[
    \(MidiExportSMF["\<tmp.mid\>", m]\)], "Input"],

Cell["Create a list of Midi's to test on.", "Text"],

Cell[BoxData[
    \(\((ml = MidiImportSMF /@ MidiTestFileList)\) // ColumnForm\)], "Input"],

Cell["What are the lengths of the tracks?", "Text"],

Cell[BoxData[
    \(MidiGetDurations /@ ml // ColumnForm\)], "Input"],

Cell["Equalize them per file. This also adds EOT if missing.", "Text"],

Cell[BoxData[
    \(\(MidiGetDurations[MisiAddEOT[#]] &\) /@ ml // ColumnForm\)], "Input"],

Cell["Keep the max-duration.", "Text"],

Cell[BoxData[
    \(\(MidiGetDurations[MisiAddEOT[#, True]] &\) /@ ml // 
      ColumnForm\)], "Input"],

Cell["What are the lengths of the files (unmodified)?", "Text"],

Cell[BoxData[
    \(MidiGetDuration /@ ml\)], "Input"],

Cell["On which channels per track are there notes?", "Text"],

Cell[BoxData[
    \(\(MidiGetChannels[#] &\) /@ ml // ColumnForm\)], "Input"],

Cell["\<\
Do the files use NoteOff's instead of NoteOn's with velocity \
zero?\
\>", "Text"],

Cell[BoxData[
    \(\(# === MidiNormalizeNoteOff[#] &\) /@ ml\)], "Input"],

Cell["\<\
If a second parameter is supplied you can turn all \
NoteOff-velocitys to zero.\
\>", "Text"],

Cell["\<\
Currently, some of the functions just called above only work if the \
Midi-object has shape MidiFile.\
\>", "Text"],

Cell["\<\
Since changing to shape MidiVoice is neglecting velocity for \
NoteOff's I'll set them all to zero so that I easier can check for any \
loss.\
\>", "Text"],

Cell[BoxData[
    \(m = MidiNormalizeNoteOff[m, True]\)], "Input"],

Cell["\<\
I will also change timing to MidiAbsolute for the same \
reason.\
\>", "Text"],

Cell[BoxData[
    \(m = MidiSetState[m, {MidiTiming \[Rule] MidiAbsolute}]\)], "Input"],

Cell["\<\
When shape is MidiFile the music-part is a list of tracks \
containing events as {timing, {type, data}}.\
\>", "Text"],

Cell["\<\
Type is always an integer, except if the event is a meta-event, \
then its a list as {255,integer}.\
\>", "Text"],

Cell[BoxData[
    \(m[\([2]\)] // ColumnForm\)], "Input"],

Cell["\<\
This looks very much like an EventList in the original \
musica-package.\
\>", "Text"],

Cell["Change shape to MidiVoice.", "Text"],

Cell[BoxData[
    \(mv = MidiSetState[m, {MidiShape \[Rule] MidiVoice}]\)], "Input"],

Cell["\<\
You can supply a MidiVoiceReleaseTimeFunction to MidiSetState when \
changing shape from MidiFile to MidiVoice to intruduce a minimum release \
time. First parameter is the track-nr, the second is the note as \
{{on,off},{ch,p,v}}.\
\>", "Text"],

Cell[BoxData[
    \(MidiSetState[m, {MidiShape \[Rule] MidiVoice}, 
      MidiVoiceReleaseTimeFunction \[Rule] 
        Function[{t, n}, If[n[\([2, 2]\)] \[Equal] 72, Print[t, "\< \>", n]]; 
          0]]\)], "Input"],

Cell["\<\
When shape is MidiVoice the music-part is a list of voices \
containing data as {{type, track},{{timing, data}...}}.\
\>", "Text"],

Cell["There is no type MidiNoteOff in shape MidiVoice.", "Text"],

Cell["\<\
If the voice contains notes, type MidiNoteOn, track is not just a \
number but a list as {track,channel,voice}. (Im not sure if the voice-nr-info \
is useful, I might remove it).\
\>", "Text"],

Cell["\<\
If the voice contains notes, the data is {timing,{pitch,velocity}} \
since channel is added to the track-info, se above.\
\>", "Text"],

Cell["\<\
A rest is represented by the value of MidiRest. The data for a rest \
is discarded when changing back to shape MidiFile.\
\>", "Text"],

Cell[BoxData[
    \({MidiRest, MidiRestPitch, MidiRestVelocity}\)], "Input"],

Cell[BoxData[
    \({MidiRestQ[MidiRest], MidiRestPitchQ[MidiRest[\([1]\)]], 
      MidiRestVelocityQ[MidiRest[\([2]\)]]}\)], "Input"],

Cell[BoxData[
    \(mv[\([2]\)] // ColumnForm\)], "Input"],

Cell["Change shape back to MidiFile again.", "Text"],

Cell[BoxData[
    \(mf = MidiSetState[mv, {MidiShape -> MidiFile}]\)], "Input"],

Cell["\<\
What did we miss? (nothing if you used my testfile) (TODO: All \
channel messages except notes are currently discarded when changing to shape \
MidiVoice or MidiChord).\
\>", "Text"],

Cell[BoxData[
    \(MapThread[Complement, {m[\([2]\)], mf[\([2]\)]}] // 
      ColumnForm\)], "Input"],

Cell["\<\
What did we add? This should at least be all empty for all \
testfiles.\
\>", "Text"],

Cell[BoxData[
    \(MapThread[Complement, {mf[\([2]\)], m[\([2]\)]}] // 
      ColumnForm\)], "Input"],

Cell["Next shape is MidiChord.", "Text"],

Cell[BoxData[
    \(mc = MidiSetState[mv, {MidiShape \[Rule] MidiChord}]\)], "Input"],

Cell["\<\
When shape is MidiChord the music-part is a list containing data as \
{{type, {track...}},{{timing, {data...}}...}} for each type.\
\>", "Text"],

Cell["There is no type MidiNoteOff in shape chord.", "Text"],

Cell["Currently, the data is negated if there is a tie.", "Text"],

Cell[BoxData[
    \(mc[\([2]\)] // ColumnForm\)], "Input"],

Cell["\<\
Get the list of all chords. Negative pitch means tie. Rest's are \
currently +-128.\
\>", "Text"],

Cell[BoxData[
    \(MidiTieQ[\(-3\)]\)], "Input"],

Cell[BoxData[
    \(\(\(Transpose[#]\)[\([1]\)] &\) /@ \(Transpose[
          mc[\([2, 1, 2]\)]]\)[\([2]\)]\)], "Input"],

Cell["\<\
We can use supplied patterns to check the data. Not much of a test \
yet really, but the sourcecode of the patterns may help a confused \
programmer.\
\>", "Text"],

Cell["We can check the info part.", "Text"],

Cell[BoxData[
    \(\(MatchQ[#[\([1]\)], MidiPatternInfo] &\) /@ {mf, mv, mc}\)], "Input"],

Cell["We can check the music part.", "Text"],

Cell[BoxData[
    \(\(MatchQ[#[\([2]\)], MidiPatternFile] &\) /@ {mf, mv, mc}\)], "Input"],

Cell[BoxData[
    \(\(MatchQ[#[\([2]\)], MidiPatternVoice] &\) /@ {mf, mv, mc}\)], "Input"],

Cell[BoxData[
    \(\(MatchQ[#[\([2]\)], MidiPatternChord] &\) /@ {mf, mv, mc}\)], "Input"],

Cell["Or we can check the whole package so to speak.", "Text"],

Cell[BoxData[
    \(\(MatchQ[#, MidiPatternMidi] &\) /@ {mf, mv, mc}\)], "Input"],

Cell["Change TimeUnit to MidiSec and then get the duration in sec.", "Text"],

Cell[BoxData[
    \(\(MidiGetDuration[MidiSetState[#, {MidiTimeUnit \[Rule] MidiSec}]] &\) /@ 
      ml\)], "Input"],

Cell["Get all tempo-changes and their starting time.", "Text"],

Cell[BoxData[
    \(Round[MidiGetQPM /@ ml] // ColumnForm\)], "Input"],

Cell["There are some functions for creating Midi-objects.", "Text"],

Cell["\<\
A starting point for making Midi-objects using these functions \
could be MidiEmpty:\
\>", "Text"],

Cell[BoxData[
    \(e = MidiEmpty\)], "Input"],

Cell["\<\
Add notes in a {{{{on,off},{ch,p,v}}...}...} format as returned by \
MidiGetNotes:\
\>", "Text"],

Cell[BoxData[
    \(e = MidiAddNotes[e, MidiGetNotes[m]]\)], "Input"],

Cell["Add qpm in a {{on,qpm}...} format as returned by MidiGetQPM:", "Text"],

Cell[BoxData[
    \(e = MidiAddQPM[e, MidiGetQPM[m]]\)], "Input"],

Cell["Then add/adjust EOT.", "Text"],

Cell[BoxData[
    \(e = MisiAddEOT[e]\)], "Input"],

Cell["You can also remove all notes.", "Text"],

Cell[BoxData[
    \(e = MidiRemNotes[e]\)], "Input"],

Cell["And all QPM.", "Text"],

Cell[BoxData[
    \(e = MidiRemQPM[e]\)], "Input"],

Cell["Only EOT left.", "Text"],

Cell[BoxData[
    \(e[\([2]\)] // ColumnForm\)], "Input"],

Cell["\<\
MidiSetNotes[m,n] is like calling MidiAddNotes[MidiRemNotes[m],n] \
but with better state handling.\
\>", "Text"],

Cell["\<\
Eventually, when I know how Midi-objects preferably are created, I \
will produce some more functions so that one doesnt have to mess with too \
much low level details like below. But until then: embrace!\
\>", "Text"],

Cell["\<\
Three simple ways of creating Midi-objects in a low-level-way with \
random notes getting slightly different results.\
\>", "Text"],

Cell[BoxData[
    \(\(\(NRT = 4;\)\( (*\ nr\ of\ tracks\ *) \)\)\)], "Input"],

Cell[BoxData[
    \(\(\(NRN = 100;\)\( (*\ nr\ of\ notes\ per\ track\ *) \)\)\)], "Input"],

Cell["Create a Midi object in shape file.", "Text"],

Cell[BoxData[
    \(m1 = 
      Midi[\[IndentingNewLine]{MidiShape \[Rule] MidiFile, 
          MidiTimeUnit \[Rule] MidiTick, 
          MidiTiming \[Rule] 
            MidiAbsolute}, \[IndentingNewLine]Join[\[IndentingNewLine]{{}},  \
(*\ empty\ master\ track\ *) \[IndentingNewLine]\(Flatten[#, 1] &\) /@ 
            Table[\[IndentingNewLine]Module[{s = Random[Integer, {0, 10000}], 
                  c = Random[Integer, {0, 15}], 
                  p = Random[Integer, {0, 127}], 
                  v = Random[Integer, {1, 127}], 
                  d = Random[
                      Integer, {1, 
                        100}]}, \[IndentingNewLine]{{s, {MidiNoteOn, {c, p, 
                        v}}}, {s + 
                      d, {MidiNoteOff, {c, p, 
                        0}}}}\[IndentingNewLine]], \[IndentingNewLine]{t, 
                NRT}, {i, 
                NRN}\[IndentingNewLine]]\[IndentingNewLine]]\
\[IndentingNewLine]]\)], "Input"],

Cell[BoxData[
    \(MatchQ[m1[\([2]\)], MidiPatternFile]\)], "Input"],

Cell["Create a Midi object in shape voice.", "Text"],

Cell[BoxData[
    \(m2 = 
      Midi[\[IndentingNewLine]{MidiShape \[Rule] MidiVoice, 
          MidiTimeUnit \[Rule] MidiTick, 
          MidiTiming \[Rule] 
            MidiAbsolute}, \
\[IndentingNewLine]Table[\[IndentingNewLine]Module[{c = 
                Random[Integer, {0, 
                    15}]}, \[IndentingNewLine]{{MidiNoteOn, {t, c, 
                  1}}, \[IndentingNewLine]Flatten[
                Table[\[IndentingNewLine]Module[{s = 
                        Random[Integer, {0, 10000}], 
                      p = Random[Integer, {0, 127}], 
                      v = Random[Integer, {1, 127}], 
                      d = Random[
                          Integer, {1, 100}]}, \[IndentingNewLine]{{d, {p, 
                          v}}, {d + 
                          s, {p, \(-v\)}}}\[IndentingNewLine]], \
\[IndentingNewLine]{i, NRN}\[IndentingNewLine]], 
                1]\[IndentingNewLine]}\[IndentingNewLine]], \
\[IndentingNewLine]{t, 
            NRT}\[IndentingNewLine]]\[IndentingNewLine]]\)], "Input"],

Cell[BoxData[
    \(MatchQ[m2[\([2]\)], MidiPatternVoice]\)], "Input"],

Cell["Create a Midi object in shape chord.", "Text"],

Cell[BoxData[
    \(m3 = 
      Midi[\[IndentingNewLine]{MidiShape \[Rule] MidiChord, 
          MidiTimeUnit \[Rule] MidiTick, 
          MidiTiming \[Rule] 
            MidiDelta}, \[IndentingNewLine]{{{MidiNoteOn, 
              Table[Module[{c = Random[Integer, {0, 15}]}, {t, c, 1}], {t, 
                  NRT}]}, \
\[IndentingNewLine]Table[\[IndentingNewLine]Module[{d = 
                    Random[Integer, {1, 
                        100}]}, \[IndentingNewLine]{\[IndentingNewLine]d, \
\[IndentingNewLine]Table[\[IndentingNewLine]Module[{p = 
                          Random[Integer, {0, 127}], 
                        v = Random[
                            Integer, {1, 127}]}, \[IndentingNewLine]{p, 
                        v}\[IndentingNewLine]], \[IndentingNewLine]{t, 
                      NRT}\[IndentingNewLine]]\[IndentingNewLine]}\
\[IndentingNewLine]], \[IndentingNewLine]{i, 
                NRN}\[IndentingNewLine]]\[IndentingNewLine]}}\
\[IndentingNewLine]]\)], "Input"],

Cell[BoxData[
    \(MatchQ[m3[\([2]\)], MidiPatternChord]\)], "Input"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Sound", "Subsubtitle"],

Cell["Start with a function taking sec as parameter.", "Text"],

Cell[BoxData[
    \(f = Sin[2  Pi\ 220\ #] &\)], "Input"],

Cell[BoxData[
    \(Plot[f[t], {t, 0, 0.01}]\)], "Input"],

Cell["Make a 1 sec sound-function-object.", "Text"],

Cell[BoxData[
    \(s = SoundMakeFunc[f, SoundDuration \[Rule] 1]\)], "Input"],

Cell[BoxData[
    \(SoundGetInfo[s]\)], "Input"],

Cell[BoxData[
    \(Show[s]\)], "Input"],

Cell["\<\
Zound (yes, Zound, NOT Sound) has some default-values, just like \
Midi, so the SoundDuration could have been omitted in the case above .\
\>", \
"Text"],

Cell[BoxData[
    \(Options[Zound]\)], "Input"],

Cell["Make a sound using the Audio-package.", "Text"],

Cell[BoxData[
    \(s = Waveform[Triangle, 220, 0.5]\)], "Input"],

Cell[BoxData[
    \(Show[s]\)], "Input"],

Cell["Get the function.", "Text"],

Cell[BoxData[
    \(\((f = \(SoundGetFunc[s]\)[\([1]\)])\)[t]\)], "Input"],

Cell[BoxData[
    \(Plot[f[t], {t, 0, 0.01}]\)], "Input"],

Cell["Convert sample-rate.", "Text"],

Cell[BoxData[
    \(s = SoundMakeFunc[s, SampleRate \[Rule] 2^12]\)], "Input"],

Cell[BoxData[
    \(Show[s]\)], "Input"],

Cell["Make it into a sound-sample-list.", "Text"],

Cell[BoxData[
    \(s = SoundMakeList[s]\)], "Input"],

Cell[BoxData[
    \(Show[s]\)], "Input"],

Cell["Get the function (which is really a list now).", "Text"],

Cell[BoxData[
    \(f = \(SoundGetFunc[s]\)[\([1]\)]\)], "Input"],

Cell[BoxData[
    \(Plot[f[t], {t, 0, 0.01}]\)], "Input"],

Cell["Do it again, but smothen the curve.", "Text"],

Cell[BoxData[
    \(f = \(SoundGetFunc[s, 
          InterpolationOrder \[Rule] 1]\)[\([1]\)]\)], "Input"],

Cell[BoxData[
    \(Plot[f[t], {t, 0, 0.01}]\)], "Input"],

Cell["Start with two sounds.", "Text"],

Cell[BoxData[
    \(sa = SoundMakeFunc[Sin[2  Pi\ 220\ #] &, SoundDuration \[Rule] 1]; 
    sb = SoundMakeFunc[Sin[2  Pi\ 220\ 3/2\ #] &, 
        SoundDuration \[Rule] 1];\)], "Input"],

Cell["Make a sound by combining them in paralell.", "Text"],

Cell[BoxData[
    \(sp = SoundPar[{sa, sb}]\)], "Input"],

Cell[BoxData[
    \(Show[sp]\)], "Input"],

Cell["\<\
Make a sound by combining them in sequence, just like \
Beethowen...\
\>", "Text"],

Cell[BoxData[
    \(ss = SoundSeq[{sa, sb}]\)], "Input"],

Cell[BoxData[
    \(Show[ss]\)], "Input"],

Cell["Make a sound by combining sound in paralell and in sequence.", "Text"],

Cell[BoxData[
    \(ssp = SoundSeq[{SoundPar[{sa, sb}], SoundPar[{sb, sa}]}]\)], "Input"],

Cell[BoxData[
    \(Show[ssp]\)], "Input"],

Cell["Slice it up...", "Text"],

Cell[BoxData[
    \(ssl = SoundUnSeq[ssp, {0.7, 1.1}]\)], "Input"],

Cell["...and take the portion from the middle.", "Text"],

Cell[BoxData[
    \(sm = ssl[\([2]\)]\)], "Input"],

Cell[BoxData[
    \(Show[sm]\)], "Input"],

Cell[BoxData[
    \(sd = SoundImportWav[DataFolder <> "\<lin8.wav\>"]\)], "Input"],

Cell[BoxData[
    \(SoundGetInfo[sd]\)], "Input"],

Cell[BoxData[
    \(Show[sd]\)], "Input"],

Cell["\<\
Lets get a small part from it (quite tiny actually), just the \"o\" \
when he says Torvalds.\
\>", "Text"],

Cell[BoxData[
    \(sdp = 
      SoundMakeList[\[IndentingNewLine]Take[\(SoundGetList[
              sd]\)[\([1]\)], {10300, 10342}]\[IndentingNewLine]]\)], "Input"],

Cell[BoxData[
    \(SoundGetInfo[sdp]\)], "Input"],

Cell[BoxData[
    \(Show[sdp]\)], "Input"],

Cell["\<\
Now, lets make a simple Midi to Sound converter using this snippet.\
\
\>", "Text"],

Cell[BoxData[
    \(MidiToSound[m : Midi[_, _], s_Sound, \ 
        opts___] := \[IndentingNewLine]Module[\[IndentingNewLine]{\
\[IndentingNewLine]p2f = 
            Function[p, 
              440*2^\((\((p - 57)\)/12)\)], \[IndentingNewLine]v2a = 
            Function[v, v/127], \[IndentingNewLine]osc = 
            Function[{f, a}, 
              N[a\ Sin[
                      2  Pi\ f  #]] &], \[IndentingNewLine]mf, \
\[IndentingNewLine]r, c, mix\[IndentingNewLine]}, \[IndentingNewLine] (*\ 
          get\ the\ music\ as\ {{{timing, {p, 
                        v}} ... } ... }\ *) \[IndentingNewLine]r = 
          Cases[\(MidiSetState[
                m, {MidiTimeUnit \[Rule] MidiSec, 
                  MidiShape \[Rule] MidiVoice, 
                  MidiTiming \[Rule] 
                    MidiDelta}]\)[\([2]\)], {{MidiNoteOn, _}, d$_} \[Rule] 
              d$]; \[IndentingNewLine] (*\ 
          calculate\ mean\ freq\ *) \[IndentingNewLine]mf = 
          N[Mean[Flatten[\(\((\(If[\(! MidiRestQ[#[\([2]\)]]\), 
                            p2f[#[\([2, 1]\)]], {}] &\) /@ #)\) &\) /@ 
                  r]]]; \[IndentingNewLine] (*\ 
          make\ them\ into\ lists\ of\ sound - 
            objects\ *) \[IndentingNewLine]r = \(\((\[IndentingNewLine]\(If[
                      MidiRestQ[#[\([2]\)]], \
\[IndentingNewLine]SoundOfSilence[SoundChannelCount -> 1, 
                        SoundDuration \[Rule] #[\([1]\)], 
                        opts], \[IndentingNewLine]SoundSetDuration[
                        SoundPitchShift[s, p2f[#[\([2, 1]\)]]/mf, 
                          opts], #[\([1]\)], 
                        opts]\[IndentingNewLine]] &\) /@ \
#\[IndentingNewLine])\) &\) /@ r; \[IndentingNewLine] (*\ 
          then\ use\ SoundSeq\ *) \[IndentingNewLine]r = 
          SoundSeq /@ r; \[IndentingNewLine] (*\ 
          then\ use\ SoundPar\ *) \[IndentingNewLine]r = 
          SoundPar[r]; \[IndentingNewLine] (*\ 
          create\ a\ simple\ mix\ for\ two\ output - 
            channels\ *) \[IndentingNewLine]c = 
          SoundGetChannelCount[r]; \[IndentingNewLine]mix = 
          Table[N[{Evaluate[\((c - i)\)/\((2 \((c - 1)\))\)] &, 
                Evaluate[\((i - 1)\)/\((2 \((c - 1)\))\)] &}], {i, 
              c}]; \[IndentingNewLine] (*\ 
          make\ the\ mixdown\ *) \[IndentingNewLine]SoundMix[r, 
          mix]\[IndentingNewLine]]\)], "Input"],

Cell["First, lets use a sinewavesound.", "Text"],

Cell[BoxData[
    \(m2s = MidiToSound[m, SoundMakeFunc[Sin[2  Pi\ 440\ #] &]]\)], "Input"],

Cell[BoxData[
    \(SoundGetInfo[m2s]\)], "Input"],

Cell["\<\
This takes a while to render, partly (maybe) because a Sound of \
type SampledSoundFunction with two channels must contain a list of two \
functions returning one value each instead of a single function returning a \
list of two values which would be more efficient in a mix. On my laptop, \
1GHz, it takes about 80 sec.\
\>", "Text"],

Cell[BoxData[
    \(Timing[Show[m2s]]\)], "Input"],

Cell["Then we let Linus do his solo-quartet", "Text"],

Cell[BoxData[
    \(m2s = MidiToSound[m, sdp]\)], "Input"],

Cell["On my laptop it takes about 160 sec.", "Text"],

Cell[BoxData[
    \(Timing[Show[m2s]]\)], "Input"],

Cell["\<\
Now, lets hear him sing our 3rd random composition (m3 takes 20 sec \
to convert and render, m1 and m2 takes much, much longer):\
\>", "Text"],

Cell[BoxData[
    \(Timing[Show[MidiToSound[m3, sdp]]]\)], "Input"],

Cell["Hmmm, let's leave Linus to his OS-kernel shall we?", "Text"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
},
FrontEndVersion->"5.0 for X",
ScreenRectangle->{{0, 1600}, {0, 1200}},
AutoGeneratedPackage->Automatic,
WindowSize->{788, 975},
WindowMargins->{{0, Automatic}, {31, Automatic}},
StyleDefinitions -> "Default.nb"
]

(*******************************************************************
Cached data follows.  If you edit this Notebook file directly, not
using Mathematica, you must remove the line containing CacheID at
the top of  the file.  The cache data will then be recreated when
you save this file from within Mathematica.
*******************************************************************)

(*CellTagsOutline
CellTagsIndex->{}
*)

(*CellTagsIndex
CellTagsIndex->{}
*)

(*NotebookFileOutline
Notebook[{

Cell[CellGroupData[{
Cell[1776, 53, 24, 0, 96, "Title"],
Cell[1803, 55, 53, 0, 32, "Text"],

Cell[CellGroupData[{
Cell[1881, 59, 27, 0, 51, "Subtitle"],
Cell[1911, 61, 720, 16, 284, "Text"]
}, Open  ]],

Cell[CellGroupData[{
Cell[2668, 82, 27, 0, 51, "Subtitle"],
Cell[2698, 84, 469, 9, 140, "Text"]
}, Open  ]],

Cell[CellGroupData[{
Cell[3204, 98, 24, 0, 51, "Subtitle"],
Cell[3231, 100, 88, 3, 32, "Text"],
Cell[3322, 105, 72, 2, 27, "Input",
  InitializationCell->True],
Cell[3397, 109, 117, 3, 32, "Text"],
Cell[3517, 114, 84, 2, 27, "Input",
  InitializationCell->True],
Cell[3604, 118, 70, 0, 32, "Text"],
Cell[3677, 120, 112, 2, 27, "Input",
  InitializationCell->True],
Cell[3792, 124, 775, 13, 75, "Input",
  InitializationCell->True],
Cell[4570, 139, 67, 0, 32, "Text"],
Cell[4640, 141, 166, 3, 43, "Input",
  InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{
Cell[4843, 149, 35, 0, 53, "Subtitle"],
Cell[4881, 151, 154, 3, 32, "Text"],

Cell[CellGroupData[{
Cell[5060, 158, 27, 0, 31, "Subsubtitle"],
Cell[5090, 160, 51, 0, 32, "Text"],
Cell[5144, 162, 64, 1, 27, "Input"],
Cell[5211, 165, 187, 4, 50, "Text"],
Cell[5401, 171, 404, 9, 140, "Text"],
Cell[5808, 182, 47, 1, 27, "Input"],
Cell[5858, 185, 46, 1, 27, "Input"],
Cell[5907, 188, 101, 3, 32, "Text"],
Cell[6011, 193, 48, 1, 27, "Input"],
Cell[6062, 196, 31, 0, 32, "Text"],
Cell[6096, 198, 64, 1, 27, "Input"],
Cell[6163, 201, 51, 0, 32, "Text"],
Cell[6217, 203, 91, 1, 27, "Input"],
Cell[6311, 206, 51, 0, 32, "Text"],
Cell[6365, 208, 69, 1, 27, "Input"],
Cell[6437, 211, 70, 0, 32, "Text"],
Cell[6510, 213, 90, 1, 27, "Input"],
Cell[6603, 216, 38, 0, 32, "Text"],
Cell[6644, 218, 103, 2, 27, "Input"],
Cell[6750, 222, 63, 0, 32, "Text"],
Cell[6816, 224, 54, 1, 27, "Input"],
Cell[6873, 227, 60, 0, 32, "Text"],
Cell[6936, 229, 77, 1, 27, "Input"],
Cell[7016, 232, 92, 3, 32, "Text"],
Cell[7111, 237, 74, 1, 27, "Input"],
Cell[7188, 240, 103, 3, 32, "Text"],
Cell[7294, 245, 125, 3, 32, "Text"],
Cell[7422, 250, 165, 4, 50, "Text"],
Cell[7590, 256, 66, 1, 27, "Input"],
Cell[7659, 259, 88, 3, 32, "Text"],
Cell[7750, 264, 87, 1, 27, "Input"],
Cell[7840, 267, 128, 3, 32, "Text"],
Cell[7971, 272, 123, 3, 32, "Text"],
Cell[8097, 277, 57, 1, 27, "Input"],
Cell[8157, 280, 96, 3, 32, "Text"],
Cell[8256, 285, 42, 0, 32, "Text"],
Cell[8301, 287, 84, 1, 27, "Input"],
Cell[8388, 290, 255, 5, 50, "Text"],
Cell[8646, 297, 217, 4, 43, "Input"],
Cell[8866, 303, 140, 3, 32, "Text"],
Cell[9009, 308, 64, 0, 32, "Text"],
Cell[9076, 310, 202, 4, 50, "Text"],
Cell[9281, 316, 144, 3, 32, "Text"],
Cell[9428, 321, 144, 3, 32, "Text"],
Cell[9575, 326, 76, 1, 27, "Input"],
Cell[9654, 329, 134, 2, 27, "Input"],
Cell[9791, 333, 58, 1, 27, "Input"],
Cell[9852, 336, 52, 0, 32, "Text"],
Cell[9907, 338, 79, 1, 27, "Input"],
Cell[9989, 341, 192, 4, 50, "Text"],
Cell[10184, 347, 102, 2, 27, "Input"],
Cell[10289, 351, 95, 3, 32, "Text"],
Cell[10387, 356, 102, 2, 27, "Input"],
Cell[10492, 360, 40, 0, 32, "Text"],
Cell[10535, 362, 85, 1, 27, "Input"],
Cell[10623, 365, 154, 3, 32, "Text"],
Cell[10780, 370, 60, 0, 32, "Text"],
Cell[10843, 372, 65, 0, 32, "Text"],
Cell[10911, 374, 58, 1, 27, "Input"],
Cell[10972, 377, 107, 3, 32, "Text"],
Cell[11082, 382, 49, 1, 27, "Input"],
Cell[11134, 385, 120, 2, 27, "Input"],
Cell[11257, 389, 173, 4, 50, "Text"],
Cell[11433, 395, 43, 0, 32, "Text"],
Cell[11479, 397, 90, 1, 27, "Input"],
Cell[11572, 400, 44, 0, 32, "Text"],
Cell[11619, 402, 90, 1, 27, "Input"],
Cell[11712, 405, 91, 1, 27, "Input"],
Cell[11806, 408, 91, 1, 27, "Input"],
Cell[11900, 411, 62, 0, 32, "Text"],
Cell[11965, 413, 81, 1, 27, "Input"],
Cell[12049, 416, 76, 0, 32, "Text"],
Cell[12128, 418, 116, 2, 27, "Input"],
Cell[12247, 422, 62, 0, 32, "Text"],
Cell[12312, 424, 70, 1, 27, "Input"],
Cell[12385, 427, 67, 0, 32, "Text"],
Cell[12455, 429, 108, 3, 32, "Text"],
Cell[12566, 434, 46, 1, 27, "Input"],
Cell[12615, 437, 106, 3, 32, "Text"],
Cell[12724, 442, 69, 1, 27, "Input"],
Cell[12796, 445, 76, 0, 32, "Text"],
Cell[12875, 447, 65, 1, 27, "Input"],
Cell[12943, 450, 36, 0, 32, "Text"],
Cell[12982, 452, 50, 1, 27, "Input"],
Cell[13035, 455, 46, 0, 32, "Text"],
Cell[13084, 457, 52, 1, 27, "Input"],
Cell[13139, 460, 28, 0, 32, "Text"],
Cell[13170, 462, 50, 1, 27, "Input"],
Cell[13223, 465, 30, 0, 32, "Text"],
Cell[13256, 467, 57, 1, 27, "Input"],
Cell[13316, 470, 123, 3, 32, "Text"],
Cell[13442, 475, 228, 4, 50, "Text"],
Cell[13673, 481, 141, 3, 32, "Text"],
Cell[13817, 486, 77, 1, 27, "Input"],
Cell[13897, 489, 90, 1, 27, "Input"],
Cell[13990, 492, 51, 0, 32, "Text"],
Cell[14044, 494, 960, 19, 235, "Input"],
Cell[15007, 515, 69, 1, 27, "Input"],
Cell[15079, 518, 52, 0, 32, "Text"],
Cell[15134, 520, 1035, 21, 283, "Input"],
Cell[16172, 543, 70, 1, 27, "Input"],
Cell[16245, 546, 52, 0, 32, "Text"],
Cell[16300, 548, 998, 19, 315, "Input"],
Cell[17301, 569, 70, 1, 27, "Input"]
}, Open  ]],

Cell[CellGroupData[{
Cell[17408, 575, 28, 0, 31, "Subsubtitle"],
Cell[17439, 577, 62, 0, 32, "Text"],
Cell[17504, 579, 57, 1, 27, "Input"],
Cell[17564, 582, 57, 1, 27, "Input"],
Cell[17624, 585, 51, 0, 32, "Text"],
Cell[17678, 587, 78, 1, 27, "Input"],
Cell[17759, 590, 48, 1, 27, "Input"],
Cell[17810, 593, 40, 1, 27, "Input"],
Cell[17853, 596, 163, 4, 50, "Text"],
Cell[18019, 602, 47, 1, 27, "Input"],
Cell[18069, 605, 53, 0, 32, "Text"],
Cell[18125, 607, 65, 1, 27, "Input"],
Cell[18193, 610, 40, 1, 27, "Input"],
Cell[18236, 613, 33, 0, 32, "Text"],
Cell[18272, 615, 74, 1, 27, "Input"],
Cell[18349, 618, 57, 1, 27, "Input"],
Cell[18409, 621, 36, 0, 32, "Text"],
Cell[18448, 623, 78, 1, 27, "Input"],
Cell[18529, 626, 40, 1, 27, "Input"],
Cell[18572, 629, 49, 0, 32, "Text"],
Cell[18624, 631, 53, 1, 27, "Input"],
Cell[18680, 634, 40, 1, 27, "Input"],
Cell[18723, 637, 62, 0, 32, "Text"],
Cell[18788, 639, 65, 1, 27, "Input"],
Cell[18856, 642, 57, 1, 27, "Input"],
Cell[18916, 645, 51, 0, 32, "Text"],
Cell[18970, 647, 106, 2, 27, "Input"],
Cell[19079, 651, 57, 1, 27, "Input"],
Cell[19139, 654, 38, 0, 32, "Text"],
Cell[19180, 656, 185, 3, 43, "Input"],
Cell[19368, 661, 59, 0, 32, "Text"],
Cell[19430, 663, 56, 1, 27, "Input"],
Cell[19489, 666, 41, 1, 27, "Input"],
Cell[19533, 669, 92, 3, 32, "Text"],
Cell[19628, 674, 56, 1, 27, "Input"],
Cell[19687, 677, 41, 1, 27, "Input"],
Cell[19731, 680, 76, 0, 32, "Text"],
Cell[19810, 682, 89, 1, 27, "Input"],
Cell[19902, 685, 42, 1, 27, "Input"],
Cell[19947, 688, 30, 0, 32, "Text"],
Cell[19980, 690, 66, 1, 27, "Input"],
Cell[20049, 693, 56, 0, 32, "Text"],
Cell[20108, 695, 50, 1, 27, "Input"],
Cell[20161, 698, 41, 1, 27, "Input"],
Cell[20205, 701, 82, 1, 27, "Input"],
Cell[20290, 704, 49, 1, 27, "Input"],
Cell[20342, 707, 41, 1, 27, "Input"],
Cell[20386, 710, 116, 3, 32, "Text"],
Cell[20505, 715, 165, 3, 59, "Input"],
Cell[20673, 720, 50, 1, 27, "Input"],
Cell[20726, 723, 42, 1, 27, "Input"],
Cell[20771, 726, 93, 3, 32, "Text"],
Cell[20867, 731, 2408, 44, 539, "Input"],
Cell[23278, 777, 48, 0, 32, "Text"],
Cell[23329, 779, 90, 1, 27, "Input"],
Cell[23422, 782, 50, 1, 27, "Input"],
Cell[23475, 785, 344, 6, 68, "Text"],
Cell[23822, 793, 50, 1, 27, "Input"],
Cell[23875, 796, 53, 0, 32, "Text"],
Cell[23931, 798, 58, 1, 27, "Input"],
Cell[23992, 801, 52, 0, 32, "Text"],
Cell[24047, 803, 50, 1, 27, "Input"],
Cell[24100, 806, 152, 3, 32, "Text"],
Cell[24255, 811, 67, 1, 27, "Input"],
Cell[24325, 814, 66, 0, 32, "Text"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}
]
*)



(*******************************************************************
End of Mathematica Notebook file.
*******************************************************************)

